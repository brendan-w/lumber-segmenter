function color_for_index(t){var e=282*t;return e=mod(e,360),{"background-color":"hsl("+e.toString()+", 100%, 65%)"}}function selectIndex(t){for(var e=t.val(),r=t.find("option"),n=0;n<r.length;n++)if(r[n].innerHTML===e)return n;return-1}function parse_compound_float(t){var e=parseFloat(t);if(!isNaN(e)){t.replace("and"," "),t.replace("+"," "),t.replace("-"," "),t.replace(","," "),t.replace("("," "),t.replace(")"," ");var r=t.indexOf("/");if(-1!=r){var n,a=t.lastIndexOf(" ",r),o=t.substring(r+1,t.length);-1!=a?n=t.substring(a+1,r):(n=t.substring(0,r),e=0);var s=parseFloat(n)/parseFloat(o);isNaN(s)||(e+=s)}}return e}function mod(t,e){return(t%e+e)%e}function run(){reset_display();var t=!1,e=$("#mode").val(),r=parse_compound_float($("#kerf").val()),n=[],a=[],o=[];if($sources.find("tbody tr").each(function(e,r){var o=parse_compound_float($(r).find(".length").val()),s=parseInt($(r).find(".quantity").val());if(isNaN(o))log_error("Source #"+e+": invalid length measurement"),t=!0;else if(isNaN(s))a.push({length:o});else for(var i=0;s>i;i++)n.push({length:o})}),$cuts.find("tbody tr").each(function(e,r){var n=parse_compound_float($(r).find(".length").val()),a=parseInt($(r).find(".quantity").val()),s=$(r).find(".color").css("background-color");if(isNaN(n))log_error("Cut #"+e+": invalid length measurement"),t=!0;else if(isNaN(a))log_error("Cut #"+e+": invalid quantity"),t=!0;else for(var i=0;a>i;i++)o.push({length:n,color:s})}),!t){var s=segmenter.run(e,r,n,a,o);s.success?display_results(s.data,r):log_error(s.data)}}function display_results(t,e){var r=canvas_width/largest_result(t);t.forEach(function(t){var n=add_result(),a=Math.round(t.length*r);n.find("h1").text(Math.round(100*t.length)/100);var o=n.find("canvas")[0].getContext("2d");o.fillStyle=canvas_bg,o.fillRect(0,0,a,canvas_height),o.font="normal 11pt Arial, sans-serif",o.textAlign="center",o.textBaseline="middle";var s=0;t.segments.forEach(function(n,a){var i=Math.round((n.length+e)*r);o.fillStyle=n.color,o.fillRect(s,0,i,canvas_height),o.fillStyle="#000",o.fillText(n.length,s+i/2,canvas_height/2),a!=t.segments.length-1&&o.fillRect(s+i-1,0,1,canvas_height),s+=i})}),$output.show()}function resize(){canvas_width=$output.width()-80,canvas_width=canvas_width>max_canvas_width?max_canvas_width:canvas_width}function largest_result(t){var e=0;return t.forEach(function(t){t.length>e&&(e=t.length)}),e}function add_result(){var t=$(" 	<li> 		<h1></h1> 		<canvas width='"+canvas_width+"' height='"+canvas_height+"'></canvas> 	</li>");return $output.append(t),t}function log_error(t){console.log(t),$errors.html($errors.html()+"<br>"+t),$errors.show()}function add_item(t){var e=t.find("tbody").children().last();t.append(e.clone(!0)),re_color()}function re_color(){$cuts.find("tbody tr").each(function(t,e){$(e).find(".color").css(color_for_index(t))})}function reset_display(){$welcome.hide(),$output.hide(),$output.empty(),$errors.empty()}var $sources,$cuts,$output,$errors,$welcome,canvas_width=800,canvas_height=20,canvas_bg="#888",max_canvas_width=800;$(function(){$sources=$("#sources"),$cuts=$("#cuts"),$output=$("#output"),$errors=$("#errors"),$welcome=$("#welcome"),$("#add-source").click(function(){add_item($sources)}),$("#add-cut").click(function(){add_item($cuts)}),$(".delete").on("click",function(){$(this).closest("tr").remove(),re_color()}),$("#run").click(run),re_color(),resize()});